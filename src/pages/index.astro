---
import { defaultLocale, SUPPORTED_LOCALES, translations } from '../i18n/translations';

const fallbackLocale = defaultLocale;
const fallbackHref = `/${fallbackLocale}/`;
const switcherLinks = SUPPORTED_LOCALES.map((locale) => ({
	lang: locale,
	label: translations[defaultLocale].layout.languageNames[locale],
	href: `/${locale}/`,
}));
const supportedLocalesJson = JSON.stringify(SUPPORTED_LOCALES);
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Redirecting…</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="refresh" content={`0;url=${fallbackHref}`} />
		<script is:inline>
			(function () {
				const supported = ${supportedLocalesJson};
				const fallback = '${fallbackLocale}';
				try {
					const stored = localStorage.getItem('preferredLocale');
					const storedValid = stored && supported.includes(stored) ? stored : null;
					const browserLang =
						(navigator.languages && navigator.languages[0]) || navigator.language || fallback;
					const normalized = (browserLang || '').toLowerCase().split('-')[0];
					const best = storedValid || (supported.includes(normalized) ? normalized : fallback);
					const target = '/' + best + '/';
					if (!location.pathname.startsWith(target)) {
						location.replace(target);
					}
				} catch (error) {
					location.replace('/' + fallback + '/');
				}
			})();
		</script>
		<style>
			body {
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
				margin: 0;
				min-height: 100vh;
				display: grid;
				place-items: center;
				background: #0b0f1a;
				color: #f4f7ff;
				text-align: center;
				padding: 24px;
			}

			main {
				display: grid;
				gap: 12px;
			}

			ul {
				list-style: none;
				padding: 0;
				margin: 0;
				display: flex;
				gap: 12px;
				justify-content: center;
			}

			a {
				color: #4d8dff;
				text-decoration: none;
				font-weight: 600;
			}

			a:hover {
				text-decoration: underline;
			}
		</style>
	</head>
	<body>
		<main>
			<h1>Redirecting…</h1>
			<p>If nothing happens, pick your preferred language below.</p>
			<ul>
				{switcherLinks.map((link) => (
					<li>
						<a href={link.href} hreflang={link.lang}>{link.label}</a>
					</li>
				))}
			</ul>
		</main>
	</body>
</html>
